<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploratory Analysis • RandomActsofPizza</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Random Acts of Pizza</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Analysis</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://ryankuhn.net">ryankuhn.net</a>
</li>
<li>
  <a href="https://github.com/kuhnrl30/RandomActsofPizza">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Exploratory Analysis</h1>
            
            <h4 class="date">April 17, 2017</h4>
          </div>

    
    
<div class="contents">
<div id="the-challenge" class="section level2">
<h2 class="hasAnchor">
<a href="#the-challenge" class="anchor"></a>The Challenge</h2>
<p>Kaggle launched a machine learning challenge based on the Random Acts of Pizza (RAOP) project on <a href="http://www.reddit.com/r/Random_Acts_Of_Pizza/">Reddit</a>. The basic premise of ROAP is that people can buy a pizza for any random person that asks for it. People have made requests by describing hard times, asking very politely, or even offering to write poems in return. The challenge was to predict whether a request would be successful and receive a free pizza. Here is the link to the competition page: <a href="http://www.kaggle.com/c/random-acts-of-pizza/data">Link</a>.</p>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<div id="setup-the-environment" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-the-environment" class="anchor"></a>Setup the Environment</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RandomActsofPizza)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(dplyr)      <span class="co"># data manipulation</span>
<span class="kw">library</span>(ggplot2)    <span class="co"># plotting</span>
<span class="kw">library</span>(httr)
<span class="kw">library</span>(tm)</code></pre></div>
</div>
<div id="load-the-training-data" class="section level4">
<h4 class="hasAnchor">
<a href="#load-the-training-data" class="anchor"></a>Load the Training Data</h4>
<p>You could get the data directly from the Kaggle website but they’ll require you to sign in and accept the terms of the competition. Unfortunately, they haven’t developed an API to do this programatically but you can get it from my Dropbox. The data downloads as a 1.7MB zip file in JSON format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trainURL  &lt;-<span class="st"> "https://onedrive.live.com/download?cid=CE1B639CAE3DDA03&amp;resid=CE1B639CAE3DDA03%2128205&amp;authkey=AMx1Yp1M2GIga6o"</span>
Train.raw &lt;-<span class="st"> </span>httr::<span class="kw">content</span>(<span class="kw">GET</span>(trainURL),<span class="st">"parsed"</span>)
train     &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PrepareData.html">PrepareData</a></span>(Train.raw)

testURL   &lt;-<span class="st"> "https://onedrive.live.com/download?cid=CE1B639CAE3DDA03&amp;resid=CE1B639CAE3DDA03%2128034&amp;authkey=AJSyWkddIKdJaCg"</span>
Test.raw  &lt;-<span class="st"> </span>httr::<span class="kw">content</span>(<span class="kw">GET</span>(testURL),<span class="st">"parsed"</span>)
test      &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PrepareData.html">PrepareData</a></span>(Test.raw)</code></pre></div>
<p>The Kaggle website describes the <strong>requester_user_flair</strong> field as used to say if the requester received pizza, received pizza and gave pizza, or didn’t receive any pizza. This seems like it would give away the outcome of the request so we’ll check to see if its in the test dataset. This field as well as a few others are only in the training dataset. There are only 17 fields in the test set while there are 32 fields in the training set. These fields will be removed to prevent us from building model on data points that won’t be available later when we apply the model to the test dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#remove columns not in test set and put in the same order</span>
train&lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw">names</span>(test)), requester_received_pizza)

<span class="co"># Convert all N/A to NA</span>
train&lt;-<span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(train,function(x) <span class="kw">gsub</span>(<span class="st">"N/A"</span>,<span class="ot">NA</span>,x)),<span class="dt">stringsAsFactors=</span>F)
test &lt;-<span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(test, function(x) <span class="kw">gsub</span>(<span class="st">"N/A"</span>,<span class="ot">NA</span>,x)),<span class="dt">stringsAsFactors=</span>F)

<span class="co"># convert character columns to numeric</span>
train[,<span class="kw">c</span>(<span class="dv">5</span>:<span class="dv">11</span>,<span class="dv">13</span>:<span class="dv">14</span>,<span class="dv">16</span>:<span class="dv">17</span>)]&lt;-<span class="kw">apply</span>(train[,<span class="kw">c</span>(<span class="dv">5</span>:<span class="dv">11</span>,<span class="dv">13</span>:<span class="dv">14</span>,<span class="dv">16</span>:<span class="dv">17</span>)], <span class="dv">2</span>,as.numeric)
test[,<span class="kw">c</span>(<span class="dv">5</span>:<span class="dv">11</span>,<span class="dv">13</span>:<span class="dv">14</span>,<span class="dv">16</span>:<span class="dv">17</span>)] &lt;-<span class="kw">apply</span>(test[,<span class="kw">c</span>(<span class="dv">5</span>:<span class="dv">11</span>,<span class="dv">13</span>:<span class="dv">14</span>,<span class="dv">16</span>:<span class="dv">17</span>)], <span class="dv">2</span>,as.numeric)
train$requester_received_pizza&lt;-<span class="kw">ifelse</span>(train$requester_received_pizza==<span class="st">"TRUE"</span>,<span class="dv">1</span>,<span class="dv">0</span>)</code></pre></div>
</div>
</div>
<div id="exploratory-analytics-and-feature-engineering" class="section level2">
<h2 class="hasAnchor">
<a href="#exploratory-analytics-and-feature-engineering" class="anchor"></a>Exploratory Analytics and Feature Engineering</h2>
<div id="finding-the-missing-values" class="section level4">
<h4 class="hasAnchor">
<a href="#finding-the-missing-values" class="anchor"></a>Finding the Missing Values</h4>
<p>With the dataset loaded, we’ll start with some exploratory analysis to understand the dataset. We’ll look at the attribute names and then make several plots determine which of the attributes might add predictive power. Let’s take a quick look at the dataset and see where the missing values are.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NA.counts&lt;-plyr::<span class="kw">ldply</span>(<span class="kw">lapply</span>(train,function(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x))))
NA.counts %&gt;%
<span class="st">    </span><span class="kw">filter</span>(!V1==<span class="dv">0</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/simpleprint.html">simpleprint</a></span>()</code></pre></div>
<pre><code>        giver_username_if_known 3753
requester_subreddits_at_request  729</code></pre>
</div>
<div id="analysis-of-time-values" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-of-time-values" class="anchor"></a>Analysis of Time Values</h3>
<p>Next, we’ll look at the success rates by different time periods to see if there are any trends with time. We’ll need to convert the date fields to POSIXct so the year can be extracted and then we can create a chart of the success rates. Using the table below, we can see that success rates have decreased across the years- both proportionally and nominally. The 2011 success rate is approximately 30 percent while the 2013 rate is a little more than 20 percent. This means that a request in 2013 is less likely to be receive a free pizza then the year before. The difference in years could have predictive power so we’ll keep it in mind for later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert date field to POSIXct format and create field for the year</span>
train&lt;-<span class="st"> </span>train %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">unix_timestamp_of_request_utc=</span> <span class="kw">as.POSIXct</span>(unix_timestamp_of_request_utc, 
                                                     <span class="dt">origin=</span> <span class="st">"1970-01-01"</span>, 
                                                     <span class="dt">tz=</span><span class="st">"UTC"</span>),
           <span class="dt">Year=</span> <span class="kw">factor</span>(<span class="kw">format</span>(unix_timestamp_of_request_utc,<span class="dt">format=</span><span class="st">'%Y'</span>)))

test&lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">unix_timestamp_of_request_utc=</span> <span class="kw">as.POSIXct</span>(unix_timestamp_of_request_utc, 
                                                     <span class="dt">origin=</span> <span class="st">"1970-01-01"</span>, 
                                                     <span class="dt">tz=</span><span class="st">"UTC"</span>),
           <span class="dt">Year=</span> <span class="kw">factor</span>(<span class="kw">format</span>(unix_timestamp_of_request_utc,<span class="dt">format=</span><span class="st">'%Y'</span>)))

train %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(Year) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Count=</span><span class="kw">length</span>(Year),
              <span class="dt">Success=</span> <span class="kw">sum</span>(requester_received_pizza)) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percent=</span><span class="kw">paste</span>(<span class="kw">round</span>(Success/Count,<span class="dv">3</span>)*<span class="dv">100</span>,<span class="st">"%"</span>, <span class="dt">sep=</span><span class="st">""</span>))</code></pre></div>
<pre><code># A tibble: 3 × 4
    Year Count Success Percent
  &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;chr&gt;
1   2011  1234     371   30.1%
2   2012  1493     352   23.6%
3   2013  1313     271   20.6%</code></pre>
<div id="success-rate-by-day-of-the-week" class="section level4">
<h4 class="hasAnchor">
<a href="#success-rate-by-day-of-the-week" class="anchor"></a>Success Rate by Day of the Week</h4>
<p>Based on the table above, it looks like requests were getting less successful with each year. Perhaps as word got out about the program there were more requesters than pizza buyers or requests became disingenuous. We’d need to investigate the text to get those answers but for now we’ll take a look at the data by day of the week. This will be a test to see if the requests are more successful on the weekend for example. This data doesn’t appear to have very strong predictive power because the variance between days is not very great.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train&lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">weekday=</span> <span class="kw">factor</span>(<span class="kw">weekdays</span>(unix_timestamp_of_request_utc,F))) 

test&lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">weekday=</span> <span class="kw">factor</span>(<span class="kw">weekdays</span>(unix_timestamp_of_request_utc,F))) 

train %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(weekday) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Count=</span><span class="kw">length</span>(weekday),
              <span class="dt">Success=</span><span class="kw">sum</span>(requester_received_pizza)) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percent=</span><span class="kw">paste</span>(<span class="kw">round</span>(Success/Count,<span class="dv">3</span>)*<span class="dv">100</span>,<span class="st">"%"</span>,<span class="dt">sep=</span><span class="st">""</span>)) </code></pre></div>
<pre><code># A tibble: 7 × 4
    weekday Count Success Percent
     &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;chr&gt;
1    Friday   544     131   24.1%
2    Monday   574     153   26.7%
3  Saturday   522     121   23.2%
4    Sunday   585     135   23.1%
5  Thursday   550     164   29.8%
6   Tuesday   606     134   22.1%
7 Wednesday   659     156   23.7%</code></pre>
<p>We can put these three time related variables into our model later and let it decide which has more predictive power.</p>
</div>
</div>
<div id="converting-to-binary-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#converting-to-binary-variables" class="anchor"></a>Converting to Binary Variables</h3>
<p>One of the fields is called giver_username_if_known. This variable is particulary interesting because, logically, in order for a giver to be known, they must first have given a pizza. We’ll convert this variable to a binary value: 0 for an NA value and 1 for when the giver username exists. We can create a table showing the success rates by this binary value. The table shows us that whenerver there is a value in the giver_username_if_known variable and it is not an NA, then the request was successful. That makes sense and we expected that result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train&lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">giver_username_if_known=</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(giver_username_if_known),<span class="dv">0</span>,<span class="dv">1</span>))

test&lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">giver_username_if_known=</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(giver_username_if_known),<span class="dv">0</span>,<span class="dv">1</span>))

train %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(giver_username_if_known) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Count=</span><span class="kw">length</span>(giver_username_if_known),
              <span class="dt">Success=</span> <span class="kw">sum</span>(requester_received_pizza)) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percent=</span><span class="kw">paste</span>(<span class="kw">round</span>(Success/Count,<span class="dv">3</span>)*<span class="dv">100</span>,<span class="st">"%"</span>,<span class="dt">sep=</span><span class="st">""</span>))</code></pre></div>
<pre><code># A tibble: 2 × 4
  giver_username_if_known Count Success Percent
                    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;chr&gt;
1                       0  3753     707   18.8%
2                       1   287     287    100%</code></pre>
<div id="did-it-help-to-add-images-to-the-request" class="section level4">
<h4 class="hasAnchor">
<a href="#did-it-help-to-add-images-to-the-request" class="anchor"></a>Did it Help to Add Images to the Request?</h4>
<p>Next, we’ll see look at the impact of attaching an image to the request. Per the research paper referenced in the competition website, attaching an image is supposed to increase the success rate. We’ll see if this holds true in our training dataset. From the table below, it appears that this is correct but there are very few instances where an image was attached. This variable may not add much to our model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train&lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Image =</span> <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">"i.imgur"</span>,train$request_text),<span class="dv">1</span>,<span class="dv">0</span>))

test&lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Image =</span> <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">"i.imgur"</span>,test$request_text),<span class="dv">1</span>,<span class="dv">0</span>))

train %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(Image) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Count=</span><span class="kw">length</span>(Image),
              <span class="dt">Success=</span> <span class="kw">sum</span>(requester_received_pizza==<span class="dv">1</span>)) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">percent=</span><span class="kw">paste</span>(<span class="kw">round</span>(Success/Count,<span class="dv">3</span>)*<span class="dv">100</span>,<span class="st">"%"</span>,<span class="dt">sep=</span><span class="st">""</span>))</code></pre></div>
<pre><code># A tibble: 2 × 4
  Image Count Success percent
  &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;   &lt;chr&gt;
1     0  3948     954   24.2%
2     1    92      40   43.5%</code></pre>
</div>
<div id="does-age-of-reddit-account-affect-the-outcome" class="section level4">
<h4 class="hasAnchor">
<a href="#does-age-of-reddit-account-affect-the-outcome" class="anchor"></a>Does Age of Reddit Account Affect the Outcome?</h4>
<p>The age of the requester’s Reddit account may have an influence on whether the request is successful. This analysis will separate users that are not likely contributors to the community and less likely to receive a free pizza. The difference in the success rates seems to indicate this variable could have predictive power.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p&lt;-<span class="st"> </span><span class="kw">ggplot</span>()
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span> <span class="dv">1</span>:<span class="dv">2000</span>,
            <span class="dt">y=</span> <span class="kw"><a href="../reference/FindCutoff.html">FindCutoff</a></span>(train$requester_received_pizza,
                   train$requester_account_age_in_days_at_request, 
                   <span class="dv">1</span>:<span class="dv">2000</span>))
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_line</span>()
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">"Cutoff level"</span>,
             <span class="dt">y=</span><span class="st">"Success Rate"</span>)
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_minimal</span>()
p</code></pre></div>
<p><img src="ExploratoryAnalysis_files/figure-html/accountAge-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train &lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Acct.Age=</span><span class="kw">ifelse</span>(requester_account_age_in_days_at_request&gt;<span class="dv">500</span>,<span class="dv">1</span>,<span class="dv">0</span>))

test &lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Acct.Age=</span><span class="kw">ifelse</span>(requester_account_age_in_days_at_request&gt;<span class="dv">500</span>,<span class="dv">1</span>,<span class="dv">0</span>))</code></pre></div>
</div>
<div id="number-of-comments" class="section level4">
<h4 class="hasAnchor">
<a href="#number-of-comments" class="anchor"></a>Number of Comments</h4>
<p>Requests may be more successful if the requester has more comments in the RAOP community. However, like the image variable, this may not add much predictive power.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p&lt;-<span class="st"> </span><span class="kw">ggplot</span>()
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span> <span class="dv">1</span>:<span class="dv">88</span>,
            <span class="dt">y=</span> <span class="kw"><a href="../reference/FindCutoff.html">FindCutoff</a></span>(train$requester_received_pizza,
                          train$requester_number_of_comments_in_raop_at_request, 
                          <span class="dv">1</span>:<span class="dv">88</span>))
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_line</span>()
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">"Cutoff level"</span>,
             <span class="dt">y=</span><span class="st">"Success Rate"</span>)
p&lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_minimal</span>()
p</code></pre></div>
<p><img src="ExploratoryAnalysis_files/figure-html/numComments-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train &lt;-<span class="st"> </span>train %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BnRAOP =</span> <span class="kw">ifelse</span>(requester_number_of_comments_in_raop_at_request&gt;<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">0</span>))

test &lt;-<span class="st"> </span>test %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BnRAOP =</span> <span class="kw">ifelse</span>(requester_number_of_comments_in_raop_at_request&gt;<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">0</span>))</code></pre></div>
</div>
</div>
<div id="text-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#text-analysis" class="anchor"></a>Text Analysis</h3>
<div id="calculating-a-basic-word-count" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-a-basic-word-count" class="anchor"></a>Calculating a Basic Word Count</h4>
<p>You can imagine that the text of the request is very important to whether the someone buys a pizza or not. It has to grab the readers attention, present a compelling case, or entertain. The text analysis starts with a simple analysis of the word count. Each request will be split and get the length, or count, of the number of words. We’ll start by grouping the requests by percentiles and determining if the success rates have enough variance to give predictive power.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train$Words&lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(train$request_text,<span class="st">" "</span>,<span class="dt">fixed=</span>T),length)
test$Words &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(test$request_text,<span class="st">" "</span>,<span class="dt">fixed=</span>T),length)

train&lt;-<span class="st"> </span><span class="kw">within</span>(train, Word.bin&lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">cut</span>(Words,<span class="kw">quantile</span>(Words, <span class="dt">probs=</span><span class="dv">0</span>:<span class="dv">2</span>/<span class="dv">2</span>), 
                                                <span class="dt">include.lowest=</span>T)))
test &lt;-<span class="st"> </span><span class="kw">within</span>(test, Word.bin&lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">cut</span>(Words, <span class="kw">quantile</span>(Words, <span class="dt">probs=</span><span class="dv">0</span>:<span class="dv">2</span>/<span class="dv">2</span>), 
                                                <span class="dt">include.lowest=</span>T)))
train %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(Word.bin) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Count=</span><span class="kw">length</span>(Word.bin),
              <span class="dt">Success=</span> <span class="kw">sum</span>(requester_received_pizza==<span class="dv">1</span>)) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percent=</span><span class="kw">paste</span>(<span class="kw">round</span>(Success/Count,<span class="dv">3</span>)*<span class="dv">100</span>,<span class="st">"%"</span>,<span class="dt">sep=</span><span class="st">""</span>))</code></pre></div>
<pre><code># A tibble: 2 × 4
  Word.bin Count Success Percent
     &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;chr&gt;
1        1  2046     407   19.9%
2        2  1994     587   29.4%</code></pre>
<p>We’ll analyze the requests using term word frequency data. The text will be reprocessed by changing all characters to lower case, removing punctuation, removing stop words, and finally stemming the words. Once processed, we’ll look for words that are in at least 90% of the documents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">removewords&lt;-<span class="kw">c</span>(<span class="st">"pizza"</span>,<span class="st">"anyon"</span>,<span class="st">"anyth"</span>,<span class="st">"appreci"</span>,<span class="st">"back"</span>)
dtmTrain&lt;-<span class="st"> </span><span class="kw"><a href="../reference/ProcessText.html">ProcessText</a></span>(train$request_text_edit_aware, <span class="dt">remove=</span>removewords)
dtmTest &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ProcessText.html">ProcessText</a></span>(test$request_text_edit_aware, <span class="dt">remove=</span>removewords)

sparseTrain&lt;-<span class="kw">removeSparseTerms</span>(dtmTrain,<span class="fl">0.90</span>)

TextTrain&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.matrix</span>(sparseTrain), <span class="dt">row.names=</span>F)

TextTest &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.matrix</span>(dtmTest), <span class="dt">row.names=</span>F)
TextTest &lt;-<span class="st"> </span>TextTest[,<span class="kw">colnames</span>(TextTest) %in%<span class="st"> </span><span class="kw">names</span>(TextTrain)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(TextTrain)</code></pre></div>
<pre><code> [1] "anyon"   "anyth"   "appreci" "broke"   "can"     "day"     "dont"   
 [8] "eat"     "even"    "food"    "forward" "friend"  "get"     "give"   
[15] "got"     "help"    "hungri"  "ill"     "ive"     "job"     "just"   
[22] "know"    "last"    "like"    "live"    "love"    "make"    "money"  
[29] "month"   "much"    "need"    "new"     "next"    "now"     "one"    
[36] "paid"    "pay"     "realli"  "right"   "someon"  "thank"   "time"   
[43] "today"   "tonight" "tri"     "want"    "week"    "will"    "work"   </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">colSums</span>(TextTrain))</code></pre></div>
<p><img src="ExploratoryAnalysis_files/figure-html/plottraintext-1.png" width="672"></p>
</div>
</div>
</div>
<div id="finalize-the-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#finalize-the-datasets" class="anchor"></a>Finalize the datasets</h2>
<p>Since we’ve done the transformations on the text fields like the username and time fields like the timestamp, we won’t need them in the final train and test datasets. We’ll keep them in another dataset <em>just in case</em>. I’ll also trim some of the longer column names by reducing ‘requester’ to ‘req’. We’ll prep the final train and test datasets by appending the text data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(train)&lt;-<span class="kw">gsub</span>(<span class="st">"requester_"</span>,<span class="st">""</span>,<span class="kw">names</span>(train))
<span class="kw">names</span>(train)&lt;-<span class="kw">gsub</span>(<span class="st">"_at_request"</span>,<span class="st">""</span>,<span class="kw">names</span>(train))

<span class="kw">names</span>(test) &lt;-<span class="kw">gsub</span>(<span class="st">"requester_"</span>,<span class="st">""</span>,<span class="kw">names</span>(test))
<span class="kw">names</span>(test) &lt;-<span class="kw">gsub</span>(<span class="st">"_at_request"</span>,<span class="st">""</span>,<span class="kw">names</span>(test))

justInCase&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rbind</span>(train[, <span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">15</span>:<span class="dv">17</span>)],
                                  test[, <span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">15</span>:<span class="dv">17</span>)]))

train &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(train[,-<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">15</span>:<span class="dv">17</span>)], TextTrain),
                       <span class="dt">stringsAsFactors=</span>F)

test &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(test[,-<span class="kw">c</span>(<span class="dv">3</span>:<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">15</span>:<span class="dv">17</span>)],  TextTest),
                      <span class="dt">stringsAsFactors=</span>F)</code></pre></div>
</div>
<div id="whats-next" class="section level2">
<h2 class="hasAnchor">
<a href="#whats-next" class="anchor"></a>What’s Next</h2>
<p>This is the end of the exploratory analysis. We’ve looked at missing values, converted numeric values to binary, and worked with the text. The analysis continues with the next vignette.</p>
<pre><code><a href="../articles/ModelBuilding.html">vignette("ModelBuilding")</a></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-challenge">The Challenge</a></li>
      <li><a href="#getting-started">Getting Started</a></li>
      <li><a href="#exploratory-analytics-and-feature-engineering">Exploratory Analytics and Feature Engineering</a></li>
      <li><a href="#finalize-the-datasets">Finalize the datasets</a></li>
      <li><a href="#whats-next">What’s Next</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ryan Kuhn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
